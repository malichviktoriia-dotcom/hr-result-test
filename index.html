<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HR Collector Pro | Modern Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

:root {
--primary: #6366f1;
--accent: #a855f7;
--glass: rgba(255, 255, 255, 0.7);
}

body {
font-family: 'Plus Jakarta Sans', sans-serif;
background: radial-gradient(circle at top right, #e0e7ff, #f8fafc, #f1f5f9);
color: #1e293b;
min-height: 100vh;
}

.glass-panel {
background: var(--glass);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.3);
box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.05);
}

.input-modern {
@apply w-full bg-white/50 border border-slate-200 rounded-2xl p-4 focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 outline-none transition-all duration-300;
}

.btn-gradient {
background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
@apply text-white font-bold py-4 px-8 rounded-2xl shadow-lg shadow-indigo-200 hover:shadow-indigo-300 hover:scale-[1.02] active:scale-95 transition-all duration-300;
}

.progress-bar {
height: 6px;
background: #e2e8f0;
border-radius: 10px;
overflow: hidden;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, #6366f1, #a855f7);
transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.option-card {
@apply relative flex items-center p-5 border-2 border-white bg-white/40 rounded-2xl hover:border-indigo-400 hover:bg-white transition-all cursor-pointer;
}

.fade-slide { animation: fadeSlide 0.5s ease-out; }
@keyframes fadeSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* PDF Styles */
.pdf-report {
background: white;
color: #1a1a1a;
padding: 40px;
font-family: sans-serif;
}
</style>
</head>
<body class="p-4 md:p-10 flex items-center justify-center">

<div id="app" class="w-full max-w-2xl">
<!-- Main Card -->
<div id="mainContainer" class="glass-panel rounded-[32px] overflow-hidden">

<!-- Dynamic Header -->
<div class="px-8 py-6 border-b border-white/40 flex justify-between items-center">
<div class="flex items-center gap-3">
<div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
</div>
<div>
<h1 class="text-sm font-extrabold text-slate-900 uppercase tracking-tighter">Collector Pro</h1>
<p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Digital Archive System</p>
</div>
</div>
<div id="statsInfo" class="hidden text-right">
<div class="progress-bar w-32 mb-1">
<div id="progressFill" class="progress-fill" style="width: 0%"></div>
</div>
<span id="timer" class="text-[10px] font-mono font-bold text-slate-400">00:00:00</span>
</div>
</div>

<!-- Content Area -->
<div id="content" class="p-8 md:p-12 min-h-[480px] flex flex-col justify-center">
<!-- Landing Screen -->
<div id="startScreen" class="fade-slide">
<h2 class="text-4xl font-extrabold text-slate-900 mb-4 tracking-tight">Начнем запись</h2>
<p class="text-slate-500 mb-10 text-lg leading-relaxed">Добро пожаловать в систему сбора профессиональных данных. Мы зафиксируем ваши ответы и подготовим структурированный отчет для HR.</p>

<div class="grid gap-6">
<div class="relative">
<label class="absolute -top-2 left-4 px-2 bg-slate-50 text-[10px] font-black text-indigo-500 uppercase tracking-widest z-10">Полное имя</label>
<input type="text" id="name" class="input-modern" placeholder="Александр Петров">
</div>
<div class="grid grid-cols-2 gap-4">
<div class="relative">
<label class="absolute -top-2 left-4 px-2 bg-slate-50 text-[10px] font-black text-indigo-500 uppercase tracking-widest z-10">Должность</label>
<input type="text" id="job" class="input-modern" placeholder="Team Lead">
</div>
<div class="relative">
<label class="absolute -top-2 left-4 px-2 bg-slate-50 text-[10px] font-black text-indigo-500 uppercase tracking-widest z-10">Возраст</label>
<input type="number" id="age" class="input-modern" placeholder="30">
</div>
</div>
</div>

<button onclick="startApp()" class="btn-gradient w-full mt-10">
Войти в систему
</button>
</div>
</div>
</div>

<p class="text-center mt-8 text-slate-400 text-xs font-medium">Data Collection Unit v4.0.0 | No algorithmic bias</p>
</div>

<!-- Hidden PDF Root -->
<div id="pdfWrapper" class="hidden">
<div id="pdfTarget" class="pdf-report"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'modern-collector';

let profile = {};
let logs = [];
let currentStep = 0;
let qStart;
let totalStart;
let timerInt;

const questions = [
{ t: "TEXT", q: "Опишите продукт вашей последней должности так, чтобы можно было измерить итог вашей работы." },
{ t: "TEXT", q: "Вспомните сложную рабочую ситуацию. Что СДЕЛАЛИ лично вы?" },
{ t: "TEXT", q: "Чем для вас отличается «я работал» от «я дал результат»?" },
{ t: "TEXT", q: "Что для вас главное в работе?" },
{ t: "TEXT", q: "Приведите пример достижения, которым вы гордитесь." },
{ t: "TEXT", q: "Как менялась ваша ответственность со временем?" },
{ t: "TEXT", q: "Как вы действуете, когда допустили ошибку?" },
{ t: "TEXT", q: "Какую пользу вы приносите компании?" },
{ t: "TEXT", q: "Как компания приносит пользу вам?" },
{ t: "TEXT", q: "Опишите себя тремя глаголами." },
{ t: "TEXT", q: "Что должно произойти, чтобы вы ушли с работы?" },
{ t: "CHOICE", q: "Вам поставили цель без инструкции:", opts: [
{ k: "A", l: "Формирую план и действую самостоятельно" },
{ k: "B", l: "Ищу регламент или спрашиваю шаблон" },
{ k: "C", l: "Жду распоряжений и подробных указаний" }
]},
{ t: "CHOICE", q: "Коллега сорвал задачу, влияющую на ваш итог:", opts: [
{ k: "A", l: "Беру ответственность и доделываю сам" },
{ k: "B", l: "Делаю только свою часть по инструкции" },
{ k: "C", l: "Сообщаю руководству и жду решения" }
]},
{ t: "CHOICE", q: "Как вы оцениваете личную эффективность?", opts: [
{ k: "A", l: "По измеримому итоговому результату" },
{ k: "B", l: "По качеству выполнения рабочих процессов" },
{ k: "C", l: "По субъективной оценке руководителя" }
]},
{ t: "YESNO", q: "Считаете ли вы, что сотрудник несет персональную ответственность за общий план?" },
{ t: "YESNO", q: "Сравниваете ли вы свои текущие результаты с результатами других?" }
];

window.startApp = async () => {
const name = document.getElementById('name').value.trim();
const job = document.getElementById('job').value.trim();
const age = document.getElementById('age').value.trim();

if (!name || !job || !age) return alert("Пожалуйста, заполните профиль");

profile = { name, job, age, timestamp: new Date().toLocaleString() };

await signInAnonymously(auth);
totalStart = Date.now();
document.getElementById('statsInfo').classList.remove('hidden');
timerInt = setInterval(updateTimer, 1000);

renderStep();
};

const updateTimer = () => {
const diff = Math.floor((Date.now() - totalStart) / 1000);
const h = Math.floor(diff / 3600).toString().padStart(2, '0');
const m = Math.floor((diff % 3600) / 60).toString().padStart(2, '0');
const s = (diff % 60).toString().padStart(2, '0');
document.getElementById('timer').innerText = `${h}:${m}:${s}`;
};

const renderStep = () => {
qStart = Date.now();
const q = questions[currentStep];
const content = document.getElementById('content');
const progress = ((currentStep) / questions.length) * 100;
document.getElementById('progressFill').style.width = `${progress}%`;

let html = `<div class="fade-slide">
<span class="text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-4 block">Шаг ${currentStep + 1} / ${questions.length}</span>
<h3 class="text-2xl font-extrabold text-slate-800 mb-8 tracking-tight">${q.q}</h3>`;

if (q.t === "TEXT") {
html += `
<textarea id="valInput" class="input-modern min-h-[200px] text-lg" placeholder="Начните писать..."></textarea>
<div class="flex justify-between items-center mt-6">
<span id="charMark" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Symbols: 0</span>
<button onclick="nextStep()" class="btn-gradient px-12 py-3 rounded-xl">Далее</button>
</div>`;
} else if (q.t === "CHOICE") {
html += `<div class="grid gap-4">`;
q.opts.forEach(o => {
html += `
<div onclick="recordVal('${o.k}', '${o.l}')" class="option-card group">
<span class="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center font-black text-slate-400 group-hover:bg-indigo-600 group-hover:text-white transition-all mr-4">${o.k}</span>
<span class="text-slate-600 font-semibold group-hover:text-indigo-900">${o.l}</span>
</div>`;
});
html += `</div>`;
} else if (q.t === "YESNO") {
html += `
<div class="flex gap-4">
<button onclick="recordVal('Да')" class="flex-1 py-14 glass-panel border-2 border-white rounded-[24px] hover:border-indigo-400 hover:text-indigo-600 font-black text-2xl transition-all">ДА</button>
<button onclick="recordVal('Нет')" class="flex-1 py-14 glass-panel border-2 border-white rounded-[24px] hover:border-indigo-400 hover:text-indigo-600 font-black text-2xl transition-all">НЕТ</button>
</div>`;
}

content.innerHTML = html;

if (q.t === "TEXT") {
const area = document.getElementById('valInput');
area.focus();
area.oninput = (e) => document.getElementById('charMark').innerText = `Symbols: ${e.target.value.length}`;
}
};

window.nextStep = () => {
const v = document.getElementById('valInput').value.trim();
if (v.length < 2) return alert("Пожалуйста, заполните ответ.");
recordVal(v);
};

window.recordVal = (val, label = null) => {
const duration = Math.floor((Date.now() - qStart) / 1000);
logs.push({
question: questions[currentStep].q,
type: questions[currentStep].t,
value: val,
label: label,
duration: duration
});

if (currentStep < questions.length - 1) {
currentStep++;
renderStep();
} else {
finalize();
}
};

const finalize = () => {
clearInterval(timerInt);
document.getElementById('progressFill').style.width = `100%`;
const content = document.getElementById('content');

content.innerHTML = `
<div class="fade-slide text-center max-w-sm mx-auto">
<div class="w-20 h-20 bg-indigo-50 text-indigo-600 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-inner">
<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
</div>
<h2 class="text-3xl font-extrabold text-slate-900 mb-3 tracking-tight">Готово</h2>
<p class="text-slate-500 mb-10">Ваша анкета сформирована. Оставьте ваш контактный Email для завершения процесса.</p>

<div class="grid gap-4">
<input type="email" id="finalEmail" class="input-modern text-center" placeholder="your@email.com">
<button onclick="cloudSubmit()" id="subBtn" class="btn-gradient w-full">Отправить HR-специалисту</button>
</div>
</div>`;
};

window.cloudSubmit = async () => {
const email = document.getElementById('finalEmail').value.trim();
if (!email.includes('@')) return alert("Укажите корректный email");

const btn = document.getElementById('subBtn');
btn.disabled = true;
btn.innerHTML = `<div class="flex items-center justify-center"><svg class="animate-spin h-5 w-5 mr-3 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Синхронизация...</div>`;

try {
await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'submissions'), {
profile: { ...profile, contact: email },
answers: logs,
totalTime: document.getElementById('timer').innerText,
createdAt: serverTimestamp()
});

showSuccess();
} catch (e) {
alert("Ошибка связи с сервером.");
btn.disabled = false;
btn.innerText = "Отправить HR-специалисту";
}
};

const showSuccess = () => {
document.getElementById('content').innerHTML = `
<div class="fade-slide text-center">
<div class="w-20 h-20 bg-green-50 text-green-600 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-inner">
<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg>
</div>
<h2 class="text-3xl font-extrabold text-slate-900 mb-3 tracking-tight">Успешно!</h2>
<p class="text-slate-500 mb-10 leading-relaxed">Данные отправлены и сохранены в облаке. <br> Теперь вы можете скачать свой PDF-отчет.</p>

<button onclick="downloadReport()" class="flex items-center justify-center gap-3 mx-auto text-indigo-600 font-bold hover:underline group">
<svg class="w-5 h-5 group-hover:translate-y-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
Сохранить PDF-Анкету
</button>
</div>`;
};

window.downloadReport = () => {
const target = document.getElementById('pdfTarget');
const totalSymbols = logs.reduce((acc, l) => acc + (typeof l.value === 'string' ? l.value.length : 0), 0);

let html = `
<div style="border-bottom: 4px solid #000; padding-bottom: 20px; margin-bottom: 30px;">
<h1 style="margin: 0; font-size: 24pt; letter-spacing: -1px;">АНКЕТА КАНДИДАТА</h1>
<p style="margin: 5px 0 0 0; font-size: 9pt; color: #666; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">Raw Data Report / Professional Analysis Required</p>
</div>

<div style="display: flex; gap: 40px; margin-bottom: 40px; font-size: 11pt;">
<div style="flex: 1;">
<p style="margin: 5px 0;"><strong>ФИО:</strong> ${profile.name}</p>
<p style="margin: 5px 0;"><strong>Должность:</strong> ${profile.job}</p>
<p style="margin: 5px 0;"><strong>Возраст:</strong> ${profile.age}</p>
</div>
<div style="flex: 1; text-align: right;">
<p style="margin: 5px 0;"><strong>Общее время:</strong> ${document.getElementById('timer').innerText}</p>
<p style="margin: 5px 0;"><strong>Дата сессии:</strong> ${profile.timestamp}</p>
</div>
</div>

<div style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 15px; margin-bottom: 40px; font-size: 10pt; line-height: 1.5;">
<strong>ВНИМАНИЕ HR:</strong> Данный файл содержит только прямые ответы кандидата. Алгоритмическая обработка не применялась. Анализируйте содержание ответов и время их подготовки (указано под каждым ответом).
</div>
`;

logs.forEach((l, i) => {
html += `
<div style="margin-bottom: 30px; page-break-inside: avoid;">
<p style="margin: 0 0 10px 0; font-weight: 800; font-size: 11pt; color: #334155;">${i+1}. ${l.question}</p>
<div style="padding: 15px; border: 1px solid #cbd5e1; background: #fff; font-size: 11pt; line-height: 1.6;">
${l.label ? `<strong>${l.value}</strong> — ${l.label}` : l.value}
</div>
<p style="margin: 5px 0 0 0; font-size: 8pt; color: #94a3b8; text-align: right; font-family: monospace;">RESPONSE_TIME: ${l.duration}s</p>
</div>
`;
});

html += `
<div style="margin-top: 50px; border-top: 1px solid #000; padding-top: 20px; font-size: 8pt; color: #999; display: flex; justify-content: space-between;">
<span>SYMBOLS_TOTAL: ${totalSymbols}</span>
<span>SESSION_VERIFIED_SECURE</span>
</div>
`;

target.innerHTML = html;

const opt = {
margin: 15,
filename: `REPORT_${profile.name.replace(/\s+/g, '_')}.pdf`,
html2canvas: { scale: 2 },
jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
};
html2pdf().set(opt).from(target).save();
};

</script>
</body>
</html>

